# 内网

## 一、概念

​	要想了解内网渗透，首先我们就要理解所谓的内网是什么意思。

​	内网（Intranet）一般指一个组织内部的计算机网络，比如一个公司内部，一个计算机机房内部，或者一个集群化服务器内部，都可以是一个内网。与内网相对的即为外网，外网就是公共互联网，一般每个内网都会有出入口网关，一般使用NAT协议来连接内外网。比起外部公共互联网络，内网是受限制的，在有着严格规则的内网中，只有内网组织内部的成员或者授权的个体才能够访问。内网能有效保护组织的信息安全。

​	内网主要有以下特点：

### **1、私密性：**

​	内网是私有网络环境，外部无法直接访问内网，有助于保护组织内部的敏感信息不被外界窥探或未经授权的访问。

### **2、资源共享：**

​	内网中的计算机可以共享文件、打印机、应用程序等资源。而这些资源一般不会暴露在危险的公共互联网中。

### **3、访问控制：**

​	一般重要的内网都有严格的访问控制，确保只有授权的人员才可以访问。访问控制可以通过软件层面（令牌，票据，凭证，用户认证等）和硬件层面（网络隔离，防火墙，子网，WAF等）来实现。

### **4、监控与审计：**

​	这个部分详细说一下。相信各位小伙伴或多或少了解过互联网公司或者其他某些大厂或者工作性质比较机密的一些公司，经常会爆出，微信聊天记录被监控，日常计算机操作呗被记录等一系列看似侵犯员工隐私的事。这一般就是在内网的出口处，或网络拓扑的核心层有对应的监控与审计的设备，既方便机密泄露时追责，也方便公司对员工的操作做监控。这也是内网的特征之一。

​	以上这些其实不仅仅是内网的特点，很多公共互联网也具备类似的特点，但在内网中这些安全性规则会更加重视。

​	

## 二、内网渗透

​	内网渗透（Intranet Penetration Testing），是指模拟黑客的攻击行为，对企业或组织内部网络进行安全评估的一种方法。其主要目的是发现并评估内网环境中的安全漏洞，从而帮助企业加强网络安全防护。内网渗透通常包括以下几个方面的工作：

### 1. 信息收集

- **网络架构分析**：评估内网的结构，识别关键资产和服务，了解网络的基础设施布局。
- **系统和服务识别**：确定内网中的操作系统、应用程序及其版本，这有助于识别已知的安全漏洞。

### 2. 漏洞扫描

- **自动化扫描**：使用各种工具自动检测网络中的已知漏洞。
- **手动检测**：针对一些复杂的或自动化工具无法准确检测的环节，执行手动检测。

### 3. 漏洞利用

- **开展攻击**：通过利用发现的漏洞，尝试入侵系统、提升权限、执行远程代码等，以评估漏洞被利用的风险和影响。
- **后门植入与持久化**：测试者可能会尝试植入后门（仅限于授权的渗透测试中），以评估组织对未授权访问的检测与响应能力。

### 4. 后渗透活动

- **数据访问与提取**：评估攻击者能否访问敏感数据，并成功提取数据。
- **横向移动**：尝试在内网中进行横向移动，即从初始控制的系统移动到其他系统，评估网络隔离措施的有效性。

### 5. 清理和报告

- **清理痕迹**：渗透测试结束后，清理所有测试过程中留下的痕迹和测试工具，确保不影响网络的正常运行。
- **详细报告**：提供一份详细的渗透测试报告，包括测试过程、发现的漏洞、利用过程、推荐的修复措施等。

​	内网渗透的主要目的是从攻击者的视角评估网络的安全性，帮助组织识别和修复潜在的安全漏洞，从而提高整体的网络安全水平。重要的是，所有的内网渗透测试活动都应该在明确的授权和合规框架内进行，确保测试过程不对组织的正常运营产生负面影响。



## 三、内网渗透方法

内网渗透是一种模拟攻击者在组织内部网络中寻找并利用安全漏洞的行为，目的是评估网络的安全性。在内网渗透测试中，安全专家通常会采取多种方法来识别和利用这些漏洞。以下是一些常用的内网渗透方法：

### 1. **信息收集**

- **活动目录枚举**：活动目录（AD）是Windows网络中用于管理用户和计算机的数据库。枚举AD可以获取用户账户信息、组策略、网络资源等。
- **网络扫描**：使用工具（如Nmap）扫描网络，识别在线主机、开放端口、运行的服务等。

### 2. **漏洞扫描和评估**

- **漏洞扫描**：利用漏洞扫描工具（如Nessus、OpenVAS）自动识别系统和应用的已知漏洞。
- **手动漏洞挖掘**：对于自动化工具无法识别的复杂应用，进行手动测试以发现潜在的安全漏洞。

### 3. **凭证访问和利用**

- **密码嗅探和破解**：利用网络嗅探工具捕获网络流量，尝试获取明文密码或可破解的密码哈希。
- **凭证重用**：利用已知的用户凭证尝试访问其他系统，因为用户常常在多个系统中重复使用相同的密码。

### 4. **权限提升**

- **利用本地漏洞**：识别并利用操作系统或安装的应用程序的漏洞，以提升到更高的权限级别。
- **应用程序漏洞利用**：特别针对内网中的应用程序，利用诸如SQL注入、跨站脚本（XSS）等漏洞获取数据或提升权限。

### 5. **横向移动**

- **利用内部服务**：通过利用文件共享、数据库、邮件系统等内部服务在内网中进行横向移动。
- **会话劫持和令牌窃取**：劫持已认证的会话或窃取认证令牌来访问受保护的资源。

### 6. **数据渗透和持久性**

- **数据访问和提取**：访问敏感数据，并将数据从目标网络中安全导出。
- **建立后门和持久访问**：在目标系统中植入后门，以便未来访问。这可能通过定时任务、服务、隐藏的用户账号等实现。

### 7. **避免检测**

- **流量混淆和加密**：加密渗透测试流量，使用代理和隧道技术来避免网络监控系统的检测。
- **日志清理和痕迹删除**：在系统上删除或修改日志文件，以隐藏渗透测试的痕迹。

​	这些方法在实际渗透测试过程中可能会组合使用，以达到评估和改善目标网络安全性的目的。需要注意的是，内网渗透测试应该在充分授权的条件下进行，确保所有活动均合法且不会对组织的日常运营造成影响。



## 四、常用DOM指令

```cmd
systeminfo		# 查看系统详细信息，如OS版本，补丁安装情况

net start		# 查看启动进程，可以根据

tasklist		# 查看系统进程

netstat -ano	# 查看端口开放情况

net view /domain # 判断是否存在域

ipconfig /all	# 查看主机名、域DNS、IP

net view		# 查看域内主机

net time /domain # 域内主机以域服务器时间为准，利用该命令判断DC（Domain Controller）

nslookup 域名		# 查看某个域名的IP

net config workstation	# 查看登录信息

whoami /all		 # 查看用户信息

net user /domain # 查看域内用户
```





## 五、总结

​	总的来说，内网渗透属于是后渗透阶段。由于网关的存在，攻击者很难直接进入内网。因此攻击者往往需要利用外部的某些漏洞，先拿到内网用户的权限。一般来说，攻击者最好的入口都是网站服务，因此，攻击者最有可能获取的是www-data用户，在进行内网权限管理的时候要尤其注意此类用户，不能有过高的权限。