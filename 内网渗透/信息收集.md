# 信息收集

***



## 一、nmap工具的基础使用方法

1、扫描IP地址：

```cmd
nmap -sn 192.168.1.0/24		# sn选项为执行ping扫描。
```

2、扫描端口：

```cmd
nmap -sT 192.168.1.1		# 基于TCP三次握手扫描

nmap -sS 192.168.1.1 		# 发送SYN数据包进行扫描

nmap -sA 192.168.1.1		# 发送ACK数据包进行扫描

nmap -Pn 192.168.1.1		# 进行不ping扫描

nmap -sV 192.168.1.1		# 扫描端口和版本

nmap -p 10-100 / -p 80, 8080, 22		# 扫描端口区间，扫描指定端口
```

3、扫描操作系统类型：

```cmd
nmap -O 192.168.1.1		# -O选项代表OS即，操作系统

# nmap之所以能扫描操作系统，是因为其收集了很多的网络设备和操作系统的指纹特征，通过与指纹库的对比，判断目标的操作系统或网络设备类型。
```

4、其他常用扫描类型：

```cmd
nmap -A 192.168.1.1		# 对目标主机全面扫描

nmap -F 192.168.1.1		# 快速扫描

nmap -T4 -v 192.168.1.1		#以T4的扫描强度输出详细内容，-v代表详细内容

nmap -sP 192.168.1.1	# ping扫描

nmap --traceroute 192.168.1.1	#路由追踪
```

---



## 二、nmap进阶用法

1、使用脚本扫描防火墙：

```cmd
nmap --script=firewalk --tracetoute 192.168.1.1
# 使用firewalk基本，加上路由追踪扫描防火墙策略。

nmap --traceroute --script firewalk --script-args firewalk.recv-timeout=60000, firewalk.max-active-probes=3,firewalk.max-retries=3,firewalk.probe-timeout=600 192.168.1.1
# --traceroute启用路由功能，
# --script firewalk启用firewalk脚本，
# --script-args指定脚本参数：{
# firewalk.recv-timeout=60000，设置超时时间为60000ms(60s)
# firewalk.max-active-probes=3，设置最大探测数量为3个
# firewalk.max-retries=3，设置每个探测数量的重试次数为3次
# firewalk.probe-timeout=600，设置等待响应的最大时间为600ms
# }

nmap -p80 --script http-waf-detect www.baidu.com
# 使用http-waf-detect脚本，扫描80端口是否有WAF(Web Apllication Firewall)，并尝试识别特定类型和配置


```

2、突破防火墙：

```cmd
nmap -f www.baidu.com	# -f为IP分段扫描，即将数据包分成较小的片段。

nmap -mtu 8 www.baidu.com	# -mtu指定了最大传输单元，可以使数据报分片发送。
```

3、去骗，去偷袭！

```cmd
nmap -D RND:10 www.baidu.com	
# -D表示指定伪装IP，RND:10表示随机生成10个IP，向目标发起扫描的数据流量中包含了这10个IP的数据包，这样可以用于混淆目标，隐藏攻击者真实IP

nmap -D 192.168.1.2,192.168.1.3,192.168.1.4 www.baidu.com
# 也可以指定具体的IP地址，一般先用-sn扫描同网段内存活主机，然后使用他们的IP进行伪装，但其实这种做法对公网设备意义不大，因为一般一个局域网只有一台出口网关，其实目标收到的流量IP都来自于这一台出口网关，IP伪装的意义不大。

nmap --sT -PN --spoof-mac aa:bb:cc:dd:ee:ff www.baidu.com
# --sT表示使用TCP连接进行扫描，-PN表示不考虑主机是否存活，直接扫描
# --spoof-mac-aa:bb:cc:dd:ee:ff 指定一个虚假的MAC地址
# 这个命令使用伪装的MAC地址对目标主机进行TCP扫描，理论上伪装了MAC地址也好，IP地址也好，这都可能由于底层协议的相关字段的改变，导致无法接收响应报文，但是nmap却能接收到相关报文，猜测nmap可能会进行ARP欺骗。

```





